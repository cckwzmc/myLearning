
jQuery(function(){jQuery("#book").addClass("on");jQuery(".readAll").click(function(){var bookId=jQuery("body").attr("bookId");window.location.href="http://book.zongheng.com/totaltome/"+bookId+".html";});jQuery(".readPart").click(function(){var bookId=jQuery("body").attr("bookId");var tomeId=jQuery(this).attr("tomeId");window.location.href="http://book.zongheng.com/parttome/"+bookId+"/"+tomeId+".html";});jQuery(".download").click(function(){var bookId=jQuery("body").attr("bookId");if(user){var logURL=jQuery(this).attr("log");if(logURL)
{logger(logURL);}
window.location.target="_blank";window.location.href="http://dl.zongheng.com/book/"+bookId+".txt";}
else
{if(window.confirm("只有登录用户才能使用全文下载,确定要登录吗?"))
{login();}}});jQuery(".myshelf").click(function(){if(user)
{window.location.target="_blank";window.location.href="http://passport.zongheng.com/myBook.do";}
else
{if(window.confirm("只有登录用户才能使用书架,确定要登录吗?"))
{login("http://passport.zongheng.com/myBook.do");}}});jQuery(".favorite").click(function()
{if(user)
{var url="/ajax/bookshelf.do";var bookId=jQuery("body").attr("bookId");var params={bookId:bookId};jQuery.ajax({type:"POST",url:url,data:params,success:function(data){if(data){if(data.mes)
{alert(data.mes);}}},dataType:"json",async:false});}
else
{if(window.confirm("只有登录用户才能使用书架,确定要登录吗?"))
{login();}}});jQuery(".voteRecommend").click(function(){if(user){var url="/ajax/book.recommend.do";var bookId=jQuery("body").attr("bookId");var tp=jQuery(this).attr("tp");var params={bookId:bookId,tp:tp};jQuery.ajax({type:"POST",url:url,data:params,success:function(data){if(data)
{if(data.mes)
{alert(data.mes);}
if(data.ret)
{if(tp==0)
{jQuery("#red").html(parseInt(jQuery("#red").html())+1);}
else if(tp==1)
{jQuery("#black").html(parseInt(jQuery("#black").html())+1);}
jQuery("#redBlackVoteNum").html(data.leftRecomment);jQuery("#userVote").html(data.leftRecomment);}}},dataType:"json",async:false});}
else
{if(window.confirm("只有登录用户才能投票,确定要登录吗?"))
{login();}}});jQuery(".readList").click(function(){var bookId=jQuery("body").attr("bookId");window.location.href="/showchapter/"+bookId+".html";});jQuery(".bookmark").click(function(){var b=false;var title=document.title;var url=window.location.href;if(window.sidebar!=null)
{try
{if(window.sidebar.addPanel!=null)
{window.sidebar.addPanel(title,url,"");return;}}
catch(e)
{}
alert("请按Ctrl+D键收藏 !");return;}
if(window.external!=null)
{try
{window.external.addFavorite(url,title);return;}
catch(e){}
try
{window.external.addToFavoritesBar(url,title,"slice");return;}
catch(e){}}
alert("您的浏览器不支持此操作, 请使用浏览器的收藏夹进行添加 !");return;});var ratio=jQuery("#pingjia").attr("ratio");jQuery("#pingjia").css("width",ratio+"%");jQuery(".login").click(function(){login();});jQuery(".reg").click(function(){window.location.href="http://passport.zongheng.com/reg.do?location="+encodeURIComponent(window.location.href);});jQuery("#submit_vote").click(function(){if(!user){if(window.confirm("注册用户才可以投票，确定登录吗？"))
{login();return;}
else
{return;}}
var bookId=jQuery("body").attr("bookId");var topicId=jQuery(this).attr("topicId");var single=jQuery(this).attr("sg");var val;if(single==="1")
{val=jQuery("input:radio[name=option_check]:checked").val();if(val==undefined||val=="")
{alert("请选择后投票");return;}}
else
{val=new Array();jQuery("input:checkbox[name=option_check]:checked").each(function(index,obj){val[index]=jQuery(obj).val();});if(val.length==0)
{alert("请选择后投票");return;}}
var callback=function(){var list=null;var table=null;if(single==="1")
{list=jQuery("input:radio[name=option_check]:checked");}
else
{list=jQuery("input:checkbox[name=option_check]:checked");}
list.each(function(){var parent=jQuery(this).parent();var prev=parent.prev();table=(table==null?parent.parent().parent():table);var totalOptions=parseInt(prev.attr("totalOptions"))+list.size();var voteNum=parseInt(prev.attr("voteNum"))+1;prev.attr("voteNum",voteNum);var percent=totalOptions>0?Math.floor(voteNum*100/totalOptions):totalOptions;});if(table!=null&&table.size()>0)
{table=table.get(0);for(var i=1;i<table.rows.length-1;i++)
{var td=jQuery(table.rows[i].cells[2]);var totalOptions=parseInt(td.attr("totalOptions"))+list.size();var voteNum=parseInt(td.attr("voteNum"));td.attr("totalOptions",totalOptions);var percent=totalOptions>0?Math.floor(voteNum*100/totalOptions):totalOptions;td.html(voteNum+"票("+percent+"%)");}}};var params={bookId:bookId,topicId:topicId,single:single,val:val};var url="/ajax/book.addvote.do";jQuery.ajax({type:"POST",url:url,data:params,success:function(data){if(data){if(data.mes){alert(data.mes);}
if(data.ret){alert("投票成功,感谢您的支持");callback();}}},dataType:"json",async:false});return false;});jQuery(".touyuepiao").click(function()
{if(user)
{var bookId=jQuery("body").attr("bookId");jQuery.ajax({type:"POST",url:"/ajax/book.addVMT.do",data:{bookId:bookId},dataType:"json",success:function(data){if(data.mes){alert(data.mes);}
if(data.ret){var voteNum=jQuery("#voteNum").html();jQuery("#voteNum").html(parseInt(voteNum)+1);}}});}else{if(window.confirm("只有登录用户才能投月票,确定要登录吗?")){login();}}});jQuery(".userUpgrade").click(function()
{if(user)
{window.location.href="http://home.zongheng.com/billing/upgrade.do";}
else
{if(window.confirm("只有登录用户才能升级VIP,确定要登录吗?"))
{login("http://home.zongheng.com/billing/upgrade.do");}}});jQuery(".authorInfo").click(function(){var userId=jQuery(this).attr("userId");window.location.href="http://home.zongheng.com/show/userInfo/"+userId+".html";});if(user){var h1=document.getElementById("baoyue");var h2=document.getElementById("level_baoyue");if(h1!=null||h2!=null)
{var bookId=jQuery("body").attr("bookId");jQuery.getJSON("/ajax/user.mbook.do",{bookId:bookId},function(data){if(data.ret=="month_auto")
{jQuery("#baoyue").text("取消续订");jQuery("#baoyue").attr("href","http://home.zongheng.com/billing/memberRecord.do?type=1");jQuery("#baoyue").attr("title","取消续订");jQuery("#level_baoyue").attr("href","http://home.zongheng.com/billing/memberRecord.do?type=1");jQuery("#level_baoyue").attr("title","取消续订");}
if(data.ret=="month_no_auto")
{jQuery("#baoyue").text("续订包月");jQuery("#baoyue").attr("href","http://home.zongheng.com/billing/memberRecord.do?type=1");jQuery("#baoyue").attr("title","续订包月");jQuery("#level_baoyue").attr("href","http://home.zongheng.com/billing/memberRecord.do?type=1");jQuery("#level_baoyue").attr("title","续订包月");}});}}
else
{jQuery("#baoyue").click(function()
{if(window.confirm("只有登录用户才能订阅，确定要登录吗？"))
{login();}
return false;});}
jQuery("#buymember").click(function(){if(window.user!=null&&window.user!=undefined)
{window.open("http://book.zongheng.com/vip/buymember.html");return false;}
else
{if(window.confirm("只有登录用户才能购买会员，确定要登录吗？"))
{login();}
return false;}});});ThreadList.addListener(function(parent){var html=jQuery("#tab_threads0").parent().html();if(html!=null&&html.indexOf("书评管理")<0)
{if(CommentUtil.isAdmin())
{var bookId=jQuery("body").attr("bookId");jQuery("<a href=\"http://book.zongheng.com/threadList/"+bookId+".html\" style=\"color: #ff0000\" target=\"_blank\">【书评管理】</a>").insertBefore("#tab_threads0");}}});jQuery(function(){var html=jQuery("#tab_threads0").parent().html();if(html!=null&&html.indexOf("书评管理")<0)
{if(CommentUtil.isAdmin()||CommentUtil.isAuthor()||CommentUtil.isModerator())
{var bookId=jQuery("body").attr("bookId");jQuery("<a href=\"http://book.zongheng.com/threadList/"+bookId+".html\" style=\"color: #ff0000\" target=\"_blank\">【书评管理】</a>").insertBefore("#tab_threads0");}}
jQuery("#tab_threads0").click(function(){jQuery("#pllb_Content0").hide();jQuery("#pllb_Content1").show();});jQuery("#tab_threads1").click(function(){jQuery("#pllb_Content0").show();jQuery("#pllb_Content1").hide();});jQuery(window).bind("scroll",function(){var height=jQuery(window).height();var scrollTop=jQuery(document).scrollTop();var position=jQuery("#pllb_Content0").position();if((height+scrollTop-60)>=position.top)
{CommentUtil.loadThreadList("pllb_Content0");jQuery(window).unbind("scroll",arguments.callee);}});jQuery("#tab_threads0").click(function(){CommentUtil.loadPerfectThreadList("pllb_Content1");});});