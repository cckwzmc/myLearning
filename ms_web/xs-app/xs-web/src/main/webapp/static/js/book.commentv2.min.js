
var CommentUtil={};CommentUtil.disable=function(e)
{if(e.size()>0)
{var dom=e.get(0);jQuery(dom).attr("class","");jQuery(dom).unbind("click");dom.click=null;dom.onclick=null;}};CommentUtil.toJson=function(s)
{if(s!=null)
{try
{return window.eval("("+s+")");}
catch(e)
{alert(e.name+": "+e.message);}}
return null;};CommentUtil.getRequestURL=function(href)
{var url=(href==null?window.location.href:href);var a=["?","&","#","="];for(var i=0;i<a.length;i++)
{var k=url.indexOf(a[i]);if(k>-1)
{url=url.substring(0,k);}}
return url;};CommentUtil.isAdmin=function()
{if(window.user!=null&&window.user!=undefined)
{return jQuery("body").attr("admin")=="true";}
return false;};CommentUtil.isAuthor=function()
{if(window.user!=null&&window.user!=undefined)
{var authorId=jQuery("body").attr("authorId");return(authorId!=null&&window.user.userId==authorId);}
return false;};CommentUtil.isModerator=function()
{if(window.user!=null&&window.user!=undefined)
{var moderatorIds=jQuery("body").attr("moderatorIds");var a=(moderatorIds!=null?moderatorIds.split(","):[]);for(var i=0;i<a.length;i++)
{if(window.user.userId==a[i])
{return true;}}}
return false;};CommentUtil.zcThread=function(src)
{var threadStatus=jQuery(src).attr("threadStatus");if(threadStatus=="1")
{alert("该主题已经被锁定，不能做此操作 ！");return;}
var bookId=jQuery(src).attr("bookId");var threadId=jQuery(src).attr("threadId");jQuery.ajax({url:"/threadop/"+bookId+"/"+threadId+"/Zc.html",type:"POST",dataType:"text",error:function(data)
{},success:function(data)
{var json=CommentUtil.toJson(data);if(json!=null)
{if(json.code==0&&json.value!=null)
{jQuery(src).html("已支持["+json.value.zcUsers+"]");CommentUtil.disable(jQuery(src));CommentUtil.disable(jQuery(src).next("span"));}
else if(json.code==1)
{alert(json.message);}}}});};CommentUtil.fdThread=function(src)
{var threadStatus=jQuery(src).attr("threadStatus");if(threadStatus=="1")
{alert("该主题已经被锁定，不能做此操作 ！");return;}
var bookId=jQuery(src).attr("bookId");var threadId=jQuery(src).attr("threadId");jQuery.ajax({url:"/threadop/"+bookId+"/"+threadId+"/Fd.html",type:"POST",dataType:"text",error:function(data)
{},success:function(data)
{var json=CommentUtil.toJson(data);if(json!=null)
{if(json.code==0&&json.value!=null)
{jQuery(src).html("已反对["+json.value.fdUsers+"]");CommentUtil.disable(jQuery(src));CommentUtil.disable(jQuery(src).prev("span"));}
else if(json.code==1)
{alert(json.message);}}}});};CommentUtil.zcPost=function(src)
{var threadStatus=jQuery(src).attr("threadStatus");if(threadStatus=="1")
{alert("该主题已经被锁定，不能做此操作 ！");return;}
var bookId=jQuery(src).attr("bookId");var postId=jQuery(src).attr("postId");if(bookId==null||postId==null)
{return;}
jQuery.ajax({url:"/postop/"+bookId+"/"+postId+"/Zc.html",type:"POST",dataType:"text",error:function(data)
{},success:function(data)
{var json=CommentUtil.toJson(data);if(json!=null)
{if(json.code==0&&json.value!=null)
{jQuery(src).html("已支持["+json.value.zcUsers+"]");CommentUtil.disable(jQuery(src));CommentUtil.disable(jQuery(src).next("span"));}
else if(json.code==1)
{alert(json.message);}}}});};CommentUtil.fdPost=function(src)
{var threadStatus=jQuery(src).attr("threadStatus");if(threadStatus=="1")
{alert("该主题已经被锁定，不能做此操作 ！");return;}
var bookId=jQuery(src).attr("bookId");var postId=jQuery(src).attr("postId");if(bookId==null||postId==null)
{return;}
jQuery.ajax({url:"/postop/"+bookId+"/"+postId+"/Fd.html",type:"POST",dataType:"text",error:function(data)
{},success:function(data)
{var json=CommentUtil.toJson(data);if(json!=null)
{if(json.code==0&&json.value!=null)
{jQuery(src).html("已反对["+json.value.fdUsers+"]");CommentUtil.disable(jQuery(src));CommentUtil.disable(jQuery(src).prev("span"));}
else if(json.code==1)
{alert(json.message);}}}});};CommentUtil.sptsy=function()
{showWindow("sptsy");jQuery(".sptsy_login").unbind();jQuery(".sptsy_login").click(function(){login();});jQuery(".sptsy_reg").unbind();jQuery(".sptsy_reg").click(function(){var refer=window.location.href;window.location.href=("http://passport.zongheng.com/reg.do?location="+encodeURIComponent(refer));});};CommentUtil.formThread=function(parent)
{if(window.user==null||window.user==undefined)
{var bookCommentIsOpen=(jQuery("body").attr("commentIsOpen")=="true");if(bookCommentIsOpen==false)
{Dialog.login("login_panel",function(){setTimeout(function(){CommentUtil.formThread(parent);},200);});return;}}
parent=(parent!=null?parent:jQuery("#comment_form_panel"));var title=jQuery.trim(parent.find("input[name=title]").val());var content=jQuery.trim(parent.find("textarea[name=content]").val());if(title=="")
{alert("请输入标题 !");return false;}
if(title.length<3)
{alert("标题太短，请至少输入3个字符 !");return false;}
if(title.length>30)
{alert("标题太长，不能超过30个字符 !");return false;}
if(content=="")
{alert("请输入内容 !");return false;}
if(content.length>4000)
{alert("内容太长，不能超过4000个字符 !");return false;}
var pattern=new RegExp("\\[cat_\\d+\\]|\\[dragon_\\d+\\]","g");var matcher=content.match(pattern);var result=content.replace(pattern,"");if(result=="")
{alert("留言不能都是表情 !");return false;}
if(matcher!=null&&matcher.length!=null&&matcher.length>5)
{alert("表情最多不能超过5个 !");return false;}
var bookId=jQuery("body").attr("bookId");var params={bookId:bookId,title:title,content:content};if(window.user==null||window.user==undefined)
{var verifyCode=jQuery.trim(parent.find("input[name=verifyCode]").val());if(verifyCode=="")
{alert("请输入验证码 !");return false;}
params.verifyCode=verifyCode;params.VerifyCodeTxt=verifyCode;}
var url="/ajax/book.commend.addThread.do";jQuery.ajax({type:"POST",url:url,data:params,dataType:"json",async:false,error:function(){alert("系统错误, 请稍候重试 !");},success:function(data){if(data)
{if(data.mes)
{alert(data.mes);}
if(data.ret)
{alert("发表书评成功");parent.find("input[name=title]").val("");parent.find("textarea[name=content]").val("");var page=jQuery("body").attr("page");if(page)
{window.location.href="/threadList/"+bookId+"/0/1.html";}
else
{window.location.reload();}}
else
{if(parent.find(".verifycode_img").css("display")!="none")
{parent.find("input[name=verifyCode]").val("");parent.find(".verifycode_btn").click();}}}
else
{alert("系统错误, 请稍候重试 !");}}});return false;}
CommentUtil.formPost=function(parent)
{if(window.user==null||window.user==undefined)
{var bookCommentIsOpen=(jQuery("body").attr("commentIsOpen")=="true");if(bookCommentIsOpen==false)
{Dialog.login("login_panel",function(){setTimeout(function(){CommentUtil.formPost(parent);},200);});return;}}
parent=(parent!=null?parent:jQuery("#comment_form_panel"));var title=jQuery.trim(parent.find("input[name=title]").val());var content=jQuery.trim(parent.find("textarea[name=content]").val());if(title=="")
{alert("请输入标题 !");return false;}
if(title.length<3)
{alert("标题太短，请至少输入3个字符 !");return false;}
if(title.length>30)
{alert("标题太长，不能超过30个字符 !");return false;}
if(content=="")
{alert("请输入内容 !");return false;}
if(content.length>2000)
{alert("内容太长，不能超过2000个字符 !");return false;}
var pattern=new RegExp("\\[cat_\\d+\\]|\\[dragon_\\d+\\]","g");var matcher=content.match(pattern);var result=content.replace(pattern,"");if(result=="")
{alert("留言不能都是表情 !");return false;}
if(matcher!=null&&matcher.length!=null&&matcher.length>5)
{alert("表情最多不能超过5个 !");return false;}
var bookId=jQuery("body").attr("bookId");var threadId=jQuery("body").attr("threadId");var replyOrder=jQuery("body").attr("replyOrder");var params={bookId:bookId,threadId:threadId,title:title,content:content,replyOrder:replyOrder};if(window.user==null||window.user==undefined)
{var verifyCode=jQuery.trim(parent.find("input[name=verifyCode]").val());if(verifyCode=="")
{alert("请输入验证码 !");return false;}
params.verifyCode=verifyCode;params.VerifyCodeTxt=verifyCode;}
var url="/ajax/book.commend.addPost.do";jQuery.ajax({type:"POST",url:url,data:params,dataType:"json",async:false,error:function(){alert("系统错误, 请稍候重试 !");},success:function(data){if(data)
{if(data.mes)
{alert(data.mes);}
if(data.ret)
{alert("发表回复成功");parent.find("input[name=title]").val("");parent.find("textarea[name=content]").val("");jQuery("body").attr("replyOrder","0");window.location.href=CommentUtil.getRequestURL();}
else
{if(parent.find(".verifycode_img").css("display")!="none")
{parent.find("input[name=verifyCode]").val("");parent.find(".verifycode_btn").click();}}}
else
{alert("系统错误, 请稍候重试 !");}}});return false;};CommentUtil.setThreadTop=function(bookId,threadIds,top,force)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.topThread.do",data:{bookId:bookId,threadIds:threadIds,top:top,force:force},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.code==0||data.code==1)
{alert(data.message);window.location.reload();}
else if(json.code==3)
{if(window.confirm(json.message))
{window.setTimeout(function(){CommentUtil.setThreadTop(bookId,threadIds,top,true)},100);}}}}});};CommentUtil.setThreadPerfect=function(bookId,threadIds,perfect)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.perfectThread.do",data:{bookId:bookId,threadIds:threadIds,perfect:perfect},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.deleteThread=function(bookId,threadIds)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.deleteThread.do",data:{bookId:bookId,threadIds:threadIds},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.lockThread=function(bookId,threadIds,lock)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.lockThread.do",data:{bookId:bookId,threadIds:threadIds,lock:lock},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.hotThread=function(bookId,threadIds)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.hotThread.do",data:{bookId:bookId,threadIds:threadIds},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.setPostPerfect=function(bookId,postIds,perfect)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.perfectPost.do",data:{bookId:bookId,postIds:postIds,perfect:perfect},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.deletePost=function(bookId,postIds,perfect)
{jQuery.ajax({type:"POST",url:"/ajax/book.commend.deletePost.do",data:{bookId:bookId,postIds:postIds},dataType:"json",error:function(data)
{alert("系统错误, 请稍候再试 !");},success:function(data)
{if(data!=null)
{if(data.mes!=null)
{alert(data.mes);window.location.reload();}}
else
{alert("系统错误, 请稍候再试 !");}}});};CommentUtil.unquote=function(s)
{var a=s;if(a!=null&&typeof(a)=="string")
{a=jQuery.trim(a);if(a.length>0&&(a.charAt(0)=="\""||a.charAt(0)=="'"))
{a=a.substring(1);}
if(a.length>0&&(a.charAt(a.length-1)=="\""||a.charAt(a.length-1)=="'"))
{a=a.substring(0,a.length-1);}}
return a;};CommentUtil.hideKspl=function(src){CommentUtil.ksplTimer=setTimeout(function(){jQuery("#kspl").hide();},300);};CommentUtil.showKspl=function(src){var n=jQuery(src);var e=jQuery("#kspl");e.attr("threadId",n.attr("threadId"));e.css("left",n.offset().left-e.width()+65).css("top",n.offset().top+16);e.show();};CommentUtil.insert=function(object,text)
{if(object==null||text==null)
{return;}
try
{object.focus();}
catch(e)
{}
var selection=document.selection;if(object.selectionStart!=null)
{var start=object.selectionStart+0;object.value=object.value.substr(0,start)+text+object.value.substr(object.selectionEnd);object.selectionStart=start+text.length;object.selectionEnd=start+text.length;}
else if(selection&&selection.createRange)
{var range=selection.createRange();range.text=text;var getLength=function(s)
{var userAgent=window.navigator.userAgent.toLowerCase();var isOpera=userAgent.indexOf("opera")!=-1&&opera.version();var isIE=(userAgent.indexOf("msie")!=-1&&!isOpera)&&userAgent.substr(userAgent.indexOf("msie")+5,3);var length=(isIE&&s.indexOf('\n')!=-1)?s.replace(/\r?\n/g,"_").length:s.length;return length;};var length=0-getLength(text);range.moveStart("character",length);}
else
{object.value+=text;}};CommentUtil.form=function(parent)
{parent.find("div.facetype span").click(function(){jQuery(this).addClass("now");jQuery(this).siblings().removeClass("now");var id=jQuery(this).attr("tabId");jQuery(this).parent().siblings().hide();parent.find("div."+id).show();});parent.find("div.showimg span").click(function(){jQuery(this).addClass("now");jQuery(this).siblings().removeClass("now");var id=jQuery(this).text();jQuery(this).parent().parent().find("table.comic").hide();jQuery(this).parent().parent().find("table.facepanel"+id).show();});parent.find("table.comic").find("tr td img").mouseover(function(){jQuery(this).css({"border":"1px solid #ff0000"});});parent.find("table.comic").find("tr td img").mouseout(function(){jQuery(this).css({"border":"1px solid #ffffff"});});parent.find("table.comic").find("tr td img").click(function(){var code=jQuery(this).attr("facecode");if(parent.find("textarea[name=content]").size()>0)
{CommentUtil.insert(parent.find("textarea[name=content]").get(0),code);}});var bookCommentIsOpen=(jQuery("body").attr("commentIsOpen")=="true");if(window.user!=null&&window.user!=undefined)
{parent.find(".login_panel").hide();parent.find(".verifycode_panel").hide();}
else
{if(bookCommentIsOpen!=true)
{parent.find(".login_panel").show();parent.find(".verifycode_panel").hide();}
else
{parent.find(".login_panel").hide();parent.find(".verifycode_panel").show();parent.find(".verifycode_btn").click(function(){parent.find(".verifycode_img").show();parent.find(".verifycode_img").attr("src","http://book.zongheng.com/verify.jpg?r="+new Date().getTime());});parent.find("input[name=verifyCode]").focus(function(){var title=jQuery.trim(parent.find("input[name=title]").val());var content=jQuery.trim(parent.find("textarea[name=content]").val());if(title==""&&content=="")
{return;}
if(this.getAttribute("status")!="1")
{this.setAttribute("status","1");parent.find(".verifycode_img").show();parent.find(".verifycode_img").attr("src","http://book.zongheng.com/verify.jpg?r="+new Date().getTime());}});}}
parent.find(".sendcomment").click(function(){var send=this.getAttribute("send");if(send==null)
{send=jQuery("body").attr("send");}
if(send=="thread")
{CommentUtil.formThread(parent);}
else if(send=="post")
{CommentUtil.formPost(parent);}});};CommentUtil.load=function(id,url,data,callback)
{var e=jQuery("#"+id);var status=parseInt(e.attr("status"));status=(isNaN(status)?0:status);if(status==0)
{status++;e.attr("status",status.toString());jQuery.ajax({url:url,type:"POST",data:(data!=null?data:{r:"1"}),error:function(req){e.html("<h2 style=\"height: 60px; line-height: 60px; text-align: center;\">系统错误, 请刷新页面重试 !</h2>");},success:function(data){var v=parseInt(e.attr("status"));if(v==status)
{var flag="<!-- ok -->";if(data!=null&&data.length>=flag.length&&jQuery.trim(data.substring(data.length-flag.length))==flag)
{e.html(data);}
else
{e.html("<h2 style=\"height: 60px; line-height: 60px; text-align: center;\">系统错误, 请刷新页面重试 !</h2>");}
if(callback!=null)
{callback();}}
else
{}}});}
else
{}};CommentUtil.loadThreadList=function(id,page)
{var bookId=jQuery("body").attr("bookId");if(document.getElementById(id)!=null)
{CommentUtil.load(id,"/ajax/book.commend.getThreadList.do",{"bookId":bookId,"pageNo":page},function(){ThreadList.trigger(jQuery("#"+id));});}};CommentUtil.loadPerfectThreadList=function(id,page)
{var bookId=jQuery("body").attr("bookId");if(document.getElementById(id)!=null)
{CommentUtil.load(id,"/ajax/book.commend.getThreadList.do",{"bookId":bookId,"perfect":"true","pageNo":page},function(){ThreadList.trigger(jQuery("#"+id));});}};CommentUtil.face=function(parent)
{var FACES={"cat_1":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0128-5050.gif","cat_2":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0140-5050.gif","cat_3":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0141-5050.gif","cat_4":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0142-5050.gif","cat_5":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0143-5050.gif","cat_6":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0144-5050.gif","cat_7":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0145-5050.gif","cat_8":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0146-5050.gif","cat_9":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0147-5050.gif","cat_10":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0139-5050.gif","cat_11":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0138-5050.gif","cat_12":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0137-5050.gif","cat_13":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0129-5050.gif","cat_14":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0130-5050.gif","cat_15":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0131-5050.gif","cat_16":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0132-5050.gif","cat_17":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0133-5050.gif","cat_18":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0134-5050.gif","cat_19":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0135-5050.gif","cat_20":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0136-5050.gif","cat_21":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0148-5050.gif","cat_21":"http://static.zongheng.com/v2_0/images/cat/CPC-BQ0148-5050.gif","dragon_1":"http://static.zongheng.com/v2_0/images/dragon/01.gif","dragon_2":"http://static.zongheng.com/v2_0/images/dragon/02.gif","dragon_3":"http://static.zongheng.com/v2_0/images/dragon/03.gif","dragon_4":"http://static.zongheng.com/v2_0/images/dragon/04.gif","dragon_5":"http://static.zongheng.com/v2_0/images/dragon/05.gif","dragon_6":"http://static.zongheng.com/v2_0/images/dragon/06.gif","dragon_7":"http://static.zongheng.com/v2_0/images/dragon/07.gif","dragon_8":"http://static.zongheng.com/v2_0/images/dragon/08.gif","dragon_9":"http://static.zongheng.com/v2_0/images/dragon/09.gif","dragon_10":"http://static.zongheng.com/v2_0/images/dragon/10.gif","dragon_11":"http://static.zongheng.com/v2_0/images/dragon/11.gif","dragon_12":"http://static.zongheng.com/v2_0/images/dragon/12.gif","dragon_13":"http://static.zongheng.com/v2_0/images/dragon/13.gif","dragon_14":"http://static.zongheng.com/v2_0/images/dragon/14.gif","dragon_15":"http://static.zongheng.com/v2_0/images/dragon/15.gif","dragon_16":"http://static.zongheng.com/v2_0/images/dragon/16.gif","dragon_17":"http://static.zongheng.com/v2_0/images/dragon/17.gif","dragon_18":"http://static.zongheng.com/v2_0/images/dragon/18.gif","dragon_19":"http://static.zongheng.com/v2_0/images/dragon/19.gif","dragon_20":"http://static.zongheng.com/v2_0/images/dragon/20.gif","dragon_21":"http://static.zongheng.com/v2_0/images/dragon/21.gif","dragon_22":"http://static.zongheng.com/v2_0/images/dragon/22.gif","dragon_23":"http://static.zongheng.com/v2_0/images/dragon/23.gif","dragon_24":"http://static.zongheng.com/v2_0/images/dragon/24.gif","dragon_25":"http://static.zongheng.com/v2_0/images/dragon/25.gif","dragon_26":"http://static.zongheng.com/v2_0/images/dragon/26.gif","dragon_27":"http://static.zongheng.com/v2_0/images/dragon/27.gif","dragon_28":"http://static.zongheng.com/v2_0/images/dragon/28.gif","dragon_29":"http://static.zongheng.com/v2_0/images/dragon/29.gif","dragon_30":"http://static.zongheng.com/v2_0/images/dragon/30.gif","dragon_31":"http://static.zongheng.com/v2_0/images/dragon/31.gif","dragon_32":"http://static.zongheng.com/v2_0/images/dragon/32.gif","dragon_33":"http://static.zongheng.com/v2_0/images/dragon/33.gif","dragon_34":"http://static.zongheng.com/v2_0/images/dragon/34.gif"};parent.each(function(){var html=jQuery(this).html();var pattern=new RegExp("\\[cat_\\d+\\]|\\[dragon_\\d+\\]","g");var result=html.replace(pattern,function(s){var src=s.substring(1,s.length-1);if(FACES[src]!=null)
{return("<img src=\""+FACES[src]+"\"/>");}
else
{return"";}});jQuery(this).html(result)});};window.ThreadList=Class.getInstance(null,Listener);ThreadList.addListener(function(parent){if(parent==null)
{return false;}
parent.find("span.thread_zc").each(function(){jQuery(this).click(function(){CommentUtil.zcThread(this);})});parent.find("span.thread_fd").each(function(){jQuery(this).click(function(){CommentUtil.fdThread(this);})});parent.find("span.kspl").mouseover(function(){CommentUtil.showKspl(this);});parent.find("span.kspl").mouseout(function(){CommentUtil.hideKspl(this);});parent.find(".shortMessage").click(function(){if(user)
{var userId=jQuery(this).attr("userId");window.open("http://home.zongheng.com/msgSend.do?uId="+userId);}
else
{if(window.confirm("只有登录用户才能发短消息,确定要登录吗?"))
{login();}}});CommentUtil.face(parent.find("div.review div.text div.line1"));});jQuery(function(){jQuery("#kspl li").click(function(){var text=CommentUtil.unquote(jQuery(this).text());if(window.user==null||window.user==undefined)
{if(jQuery("body").attr("commentIsOpen")!="true")
{var src=this;Dialog.login("login_panel",function(){jQuery(src).click();});return;}
else
{jQuery("#comment_dialog_panel").find(".login_panel").show();}}
var threadId=jQuery("#kspl").attr("threadId");jQuery("body").attr("threadId",threadId);jQuery("body").attr("replyOrder","0");jQuery("body").attr("comment","dialog");Dialog.open("comment_dialog_panel");if(window.user==null||window.user==undefined)
{if(jQuery("body").attr("commentIsOpen")=="true")
{jQuery("#comment_dialog_panel").find(".login_panel").show();}
jQuery("#comment_dialog_panel").find(".my_comment_panel").hide();}
else
{jQuery("#comment_dialog_panel").find(".login_panel").hide();}
jQuery("#comment_dialog_panel").find("input[name=title]").val(text);jQuery("#comment_dialog_panel").find("textarea[name=content]").val(text);});jQuery("#kspl").mouseover(function(){if(CommentUtil.ksplTimer!=null)
{window.clearTimeout(CommentUtil.ksplTimer);}
jQuery("#kspl").show();});jQuery("#kspl").mouseout(function(){jQuery("#kspl").hide();});});jQuery(function(){jQuery(document).keyup(function(event){if(event.keyCode==13&&event.ctrlKey)
{var type=jQuery("body").attr("comment");if(type!="dialog")
{var send=jQuery("body").attr("send");var parent=jQuery("#comment_form_panel");if(send=="thread")
{CommentUtil.formThread(parent);}
else if(send=="post")
{CommentUtil.formPost(parent);}}
else
{var parent=jQuery("#comment_dialog_panel");CommentUtil.formPost(parent);}}});CommentUtil.form(jQuery("#comment_form_panel"));CommentUtil.form(jQuery("#comment_dialog_panel"));jQuery("#comment_dialog_panel").find(".close").click(function(){Dialog.close("comment_dialog_panel");jQuery("body").attr("comment","form");});jQuery("#comment_form_panel").find(".submit").attr("send","thread");jQuery("#comment_dialog_panel").find(".submit").attr("send","post");});if(window.UserManager!=null)
{UserManager.addListener(function(){if(window.user!=null&&window.user!=undefined)
{var e=jQuery("#comment_form_panel").find(".signbox");if(e.size()>0)
{e.remove();}}});}